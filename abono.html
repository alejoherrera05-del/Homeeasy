<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeEasy | Recibo de Abono</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --homeeasy-wine: #a63d56; --homeeasy-gold: #d4af37; --homeeasy-silver: #f4f4f4; }
        body { background-color: #f8f9fa; font-family: 'Montserrat', sans-serif; color: #333; margin: 0; }
        
        .btn-back { position: fixed; top: 20px; left: 20px; z-index: 1000; background: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: var(--homeeasy-wine); text-decoration: none; }

        .document-card { background-color: white; width: 100%; max-width: 500px; margin: 40px auto; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #eee; }
        
        .header-brand { 
            background-color: var(--homeeasy-wine); 
            padding: 35px 20px 25px 20px; 
            text-align: center;
        }
        .logo-receipt { max-width: 150px; height: auto; display: block; margin: 0 auto 15px auto; }
        .empresa-info { font-size: 0.75rem; font-weight: 400; color: #ffffff; }
        .empresa-info span { margin: 0 8px; display: inline-block; }
        .empresa-info i { color: var(--homeeasy-gold); margin-right: 4px; }

        .receipt-body { padding: 35px 30px; }
        .receipt-title { 
            font-weight: 800; 
            text-transform: uppercase; 
            color: var(--homeeasy-wine); 
            text-align: center; 
            margin-bottom: 25px; 
            background: var(--homeeasy-silver);
            padding: 12px;
            border-radius: 5px;
            letter-spacing: 1px;
            border-bottom: 1px solid #ddd;
        }
        
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; border-bottom: 1px dashed #eee; padding-bottom: 8px; }
        .info-label { font-size: 0.7rem; font-weight: 800; color: #999; text-transform: uppercase; }
        
        .input-ghost { border: none; border-bottom: 1px solid #ddd; width: 100%; font-weight: 600; text-align: right; background: transparent; color: #333; font-size: 0.95rem; }
        .input-ghost:focus { outline: none; border-bottom-color: var(--homeeasy-wine); }

        /* AJUSTE DE MARCO DEFINITIVO */
        .amount-box { 
            background: #fffafb; 
            padding: 40px 20px; 
            border-radius: 12px; 
            text-align: center; 
            margin: 30px 0; 
            border: 2px solid var(--homeeasy-wine); 
            position: relative;
        }
        .amount-label { font-size: 0.8rem; font-weight: 800; color: var(--homeeasy-wine); text-transform: uppercase; margin-bottom: 10px; display: block; }
        
        /* El input se ve en la web */
        .amount-val-input { 
            font-size: 2.2rem; 
            font-weight: 800; 
            color: var(--homeeasy-wine); 
            border: none; 
            width: 100%; 
            text-align: center; 
            background: transparent;
        }

        /* El texto espejo se ve solo en el PDF */
        #valor-espejo {
            display: none;
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--homeeasy-wine);
            width: 100%;
            text-align: center;
        }
        
        .footer-receipt { text-align: center; padding: 20px; background: #fafafa; font-size: 0.85rem; color: #777; border-top: 1px solid #eee; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        .btn-download { background: var(--homeeasy-wine); color: white; border: none; width: 100%; padding: 20px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Reglas de impresión/exportación */
        .is-exporting .no-print, .is-exporting .amount-val-input { display: none !important; }
        .is-exporting #valor-espejo { display: block !important; }

        @media (max-width: 600px) {
            .empresa-info span { display: block; margin: 5px 0; }
        }
    </style>
</head>
<body>

<a href="index.html" class="btn-back no-print"><i class="fas fa-arrow-left"></i></a>

<div id="area-pdf" class="document-card">
    <div class="header-brand">
        <img src="https://i.ibb.co/kVrX85J5/logo.jpg" alt="HomeEasy Logo" class="logo-receipt" crossorigin="anonymous">
        <div class="empresa-info">
            <p class="fw-bold mb-2">NIT: 1.061.760.850-1</p>
            <div>
                <span><i class="fas fa-map-marker-alt"></i> Trav. 9 # 6N-26 (Popayán)</span>
                <span><i class="fas fa-mobile-alt"></i> 3334319374</span>
                <span><i class="fab fa-instagram"></i> @Homeeasypopayan</span>
            </div>
        </div>
    </div>

    <div class="receipt-body">
        <div class="receipt-title">Comprobante de Ingreso</div>

        <div class="info-row">
            <span class="info-label">FECHA DE PAGO:</span>
            <input type="date" id="fecha" class="input-ghost" style="width: 150px;">
        </div>
        <div class="info-row">
            <span class="info-label">NOMBRE DEL CLIENTE:</span>
            <input type="text" id="cliente" class="input-ghost" placeholder="Escriba el nombre" style="width: 220px;">
        </div>
        <div class="info-row">
            <span class="info-label">CONCEPTO:</span>
            <input type="text" id="concepto" class="input-ghost" placeholder="Abono a pedido #001" style="width: 220px;">
        </div>

        <div class="amount-box">
            <span class="amount-label">Valor Recibido</span>
            <input type="text" id="valor" class="amount-val-input" placeholder="$ 0" oninput="formatearMoneda(this)">
            <div id="valor-espejo">$ 0</div>
        </div>

        <div class="info-row">
            <span class="info-label">MEDIO DE PAGO:</span>
            <select id="medio" class="input-ghost" style="width: 160px;">
                <option value="Transferencia">Transferencia</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Datafono">Datáfono</option>
            </select>
        </div>
    </div>

    <div class="footer-receipt">
        HomeEasy
    </div>

    <button class="btn-download no-print" onclick="generarPDF()">Descargar Recibo</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
    document.getElementById('fecha').valueAsDate = new Date();

    function formatearMoneda(input) {
        let valor = input.value.replace(/\D/g, "");
        if (valor === "") { 
            input.value = ""; 
            document.getElementById('valor-espejo').innerText = "$ 0";
            return; 
        }
        let formateado = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(valor);
        input.value = formateado;
        // Sincronizamos con el espejo
        document.getElementById('valor-espejo').innerText = formateado;
    }

    async function generarPDF() {
        const { jsPDF } = window.jspdf;
        const element = document.getElementById('area-pdf');
        
        // Activamos modo exportación (oculta botones e inputs, muestra textos planos)
        element.classList.add('is-exporting');
        
        try {
            const canvas = await html2canvas(element, { 
                scale: 3, 
                useCORS: true,
                backgroundColor: "#ffffff"
            });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', [140, 200]); 
            pdf.addImage(imgData, 'PNG', 0, 0, 140, (canvas.height * 140) / canvas.width);
            
            const nombre = document.getElementById('cliente').value || 'Cliente';
            pdf.save(`Recibo_HomeEasy_${nombre}.pdf`);
        } catch (e) { 
            alert("Error al generar el recibo."); 
        } finally { 
            // Volvemos al modo normal
            element.classList.remove('is-exporting');
        }
    }
</script>
</body>
</html>

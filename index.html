<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">

<!-- Viewport optimizado para iPhone notch -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- PWA & iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#a63d56">

<title>HomeEasy | Gesti贸n</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
    --homeeasy-wine:#a63d56;
    --homeeasy-gold:#d4af37;
    --brand-color:#8d374f;
    --brand-dark:#6b293b;
    --glass-bg:rgba(255,255,255,0.12);
    --glass-border:rgba(255,255,255,0.18);
}

/* ===== BASE MOBILE OPTIMIZATION ===== */

html,body{
    margin:0;
    padding:0;
    height:100%;
    font-family:'Montserrat',sans-serif;
    -webkit-font-smoothing:antialiased;
    -webkit-tap-highlight-color:transparent;
}

/* Safe areas para iPhone */
body{
    min-height:100dvh;
    background:#f8f9fa;
    display:flex;
    justify-content:center;
    align-items:center;
    padding-top:env(safe-area-inset-top);
    padding-bottom:env(safe-area-inset-bottom);
    padding-left:env(safe-area-inset-left);
    padding-right:env(safe-area-inset-right);
    overflow-x:hidden;
}

/* ================= INTRO ================= */

#intro-screen{
    position:fixed;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    background:radial-gradient(circle at center,var(--brand-color) 0%,var(--brand-dark) 100%);
    color:white;
    z-index:99999;
    transition:opacity .8s ease, visibility .8s ease;
}

.intro-hidden{
    opacity:0;
    visibility:hidden;
}

.main-container{
    width:100%;
    max-width:420px;
    text-align:center;
    padding:20px;
}

.logo-triangulo{
    width:75px;
    margin-bottom:10px;
}

.version-tag{
    font-size:.8rem;
    letter-spacing:2px;
    opacity:.7;
    margin-bottom:30px;
}

.hommy-static{
    width:260px;
    margin-bottom:40px;
}

.glass-loader{
    background:var(--glass-bg);
    backdrop-filter:blur(15px);
    border:1px solid var(--glass-border);
    border-radius:28px;
    padding:25px;
    width:100%;
    box-shadow:0 25px 50px rgba(0,0,0,.25);
}

.status-pill{
    display:flex;
    align-items:center;
    background:rgba(0,0,0,.2);
    padding:10px 18px;
    border-radius:40px;
    margin-bottom:15px;
}

.dot-spinner{
    width:10px;
    height:10px;
    background:var(--homeeasy-gold);
    border-radius:50%;
    margin-right:10px;
    animation:pulse 1.5s infinite;
}

@keyframes pulse{
    0%,100%{opacity:1}
    50%{opacity:.4}
}

.bar-container{
    width:100%;
    height:4px;
    background:rgba(255,255,255,.1);
    border-radius:10px;
    overflow:hidden;
}

.bar-fill{
    height:100%;
    width:0%;
    background:var(--homeeasy-gold);
    transition:width .6s ease;
}

/* ================= MENU ================= */

.menu-container{
    width:100%;
    max-width:420px;
    text-align:center;
    padding:20px;
}

.header-container{
    margin-bottom:40px;
}

.logo-img{
    width:180px;
    display:block;
    margin:0 auto;
}

.status-online{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    margin-top:15px;
    padding:8px 18px;
    border-radius:50px;
    background:white;
    font-size:.65rem;
    font-weight:800;
    letter-spacing:1.5px;
    color:#555;
    box-shadow:0 5px 15px rgba(0,0,0,.08);
}

.pulse-green{
    width:8px;
    height:8px;
    background:#2ecc71;
    border-radius:50%;
    margin-right:10px;
    position:relative;
}

.pulse-green::after{
    content:"";
    position:absolute;
    width:100%;
    height:100%;
    background:#2ecc71;
    border-radius:50%;
    animation:premium-pulse 2s infinite;
}

@keyframes premium-pulse{
    0%{transform:scale(1);opacity:.8}
    100%{transform:scale(3);opacity:0}
}

.menu-card{
    background:white;
    border-radius:18px;
    padding:20px;
    margin-bottom:18px;
    display:flex;
    align-items:center;
    text-decoration:none;
    color:#333;
    box-shadow:0 10px 25px rgba(0,0,0,.06);
    transition:transform .25s ease, box-shadow .25s ease;
}

.menu-card:active{
    transform:scale(.96);
}

.icon-box{
    width:55px;
    height:55px;
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:1.3rem;
    margin-right:18px;
    background:var(--homeeasy-wine);
    color:white;
}

.gold-card .icon-box{
    background:var(--homeeasy-gold);
}

.menu-text{
    text-align:left;
}

.menu-text h3{
    margin:0;
    font-size:1rem;
    font-weight:800;
    color:var(--homeeasy-wine);
}

.gold-card .menu-text h3{
    color:var(--homeeasy-gold);
}

.menu-text p{
    margin:3px 0 0;
    font-size:.8rem;
    color:#777;
}

footer{
    margin-top:30px;
    font-size:.7rem;
    color:#aaa;
    letter-spacing:2px;
    font-weight:600;
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro-screen" style="display:none;">
    <div class="main-container">
        <img src="triangulogold.png" class="logo-triangulo">
        <h1>HomeEasy</h1>
        <div class="version-tag">Sistema Hommy 2.0</div>
        <img src="hommysaludando.png" class="hommy-static">
        <div class="glass-loader">
            <div class="status-pill">
                <div class="dot-spinner"></div>
                <div id="status-message">Conectando...</div>
            </div>
            <div class="bar-container">
                <div class="bar-fill" id="progress-bar"></div>
            </div>
        </div>
    </div>
</div>

<!-- MENU -->
<div class="menu-container">

    <div class="header-container">
        <img src="logohomeeasy.png" class="logo-img">
        <div class="status-online">
            <div class="pulse-green"></div>
            SISTEMA | ONLINE
        </div>
    </div>

    <a href="clientes.html" class="menu-card gold-card">
        <div class="icon-box"><i class="fas fa-magnifying-glass"></i></div>
        <div class="menu-text">
            <h3>Consultar Cliente</h3>
            <p>Historial y saldos pendientes</p>
        </div>
    </a>

    <a href="cotizacion.html" class="menu-card">
        <div class="icon-box"><i class="fas fa-file-invoice-dollar"></i></div>
        <div class="menu-text">
            <h3>Cotizaci贸n</h3>
            <p>Presupuestos para clientes</p>
        </div>
    </a>

    <a href="pedido.html" class="menu-card gold-card">
        <div class="icon-box"><i class="fas fa-clipboard-list"></i></div>
        <div class="menu-text">
            <h3>Orden de Pedido</h3>
            <p>Medidas y fabricaci贸n</p>
        </div>
    </a>

    <a href="abono.html" class="menu-card">
        <div class="icon-box"><i class="fas fa-receipt"></i></div>
        <div class="menu-text">
            <h3>Recibo de Abono</h3>
            <p>Comprobantes de pago</p>
        </div>
    </a>

    <footer>
        HomeEasy MANAGEMENT SYSTEM<br>
        VERSION 1.0 漏 2026
    </footer>

</div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyZHaIe7hb28KKtaPBORASy_maSZ2co8dZFce44GQRiZGYg_6WoU7qn4qC-lYCQO6ZL/exec";

window.addEventListener("load", async function() {

    const intro = document.getElementById("intro-screen");
    const progressBar = document.getElementById("progress-bar");
    const statusMessage = document.getElementById("status-message");

    //  Si ya se carg贸 en esta sesi贸n, no mostrar intro
   if (sessionStorage.getItem("APP_INIT_DONE") === "true") {
    return;
} else {
    intro.classList.remove("intro-hidden");
}

    try {

        statusMessage.innerText = "Cargando base de datos...";
        progressBar.style.width = "40%";

        const resp = await fetch(URL_SCRIPT + "?init=LOAD");
        const data = await resp.json();

        if (data.status === "ok") {

            progressBar.style.width = "70%";

            // ===== OPTIMIZAR CLIENTES =====
            const clientesRaw = data.clientes;
            const clientesObj = {};

            for (let i = 1; i < clientesRaw.length; i++) {
                const c = clientesRaw[i];
                clientesObj[c[0]] = {
                    cedula: c[0],
                    nombre: c[1],
                    telefono: c[2],
                    email: c[3],
                    direccion: c[4]
                };
            }

            // ===== OPTIMIZAR ORDENES =====
            const ordenesRaw = data.ordenes;
            const ordenesArr = [];

            for (let i = 1; i < ordenesRaw.length; i++) {
                const o = ordenesRaw[i];
                ordenesArr.push({
                    numero: o[1],
                    cedula: o[2],
                    nombre: o[3],
                    total: o[6],
                    saldo: o[10]
                });
            }

            localStorage.setItem("CACHE_CLIENTES", JSON.stringify(clientesObj));
            localStorage.setItem("CACHE_ORDENES", JSON.stringify(ordenesArr));

            progressBar.style.width = "100%";
            statusMessage.innerText = "Sistema listo";

            //  Marcar como inicializado en esta sesi贸n
            sessionStorage.setItem("APP_INIT_DONE", "true");
        }

    } catch (err) {
        console.error("Error en precarga:", err);
        statusMessage.innerText = "Error de conexi贸n";
    }

    setTimeout(() => {
        intro.classList.add("intro-hidden");
    }, 1000);

});

</script>


</body>
</html>
